(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{285:function(a,s,t){"use strict";t.r(s);var e=t(13),v=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"编译"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译"}},[a._v("#")]),a._v(" 编译")]),a._v(" "),s("h2",{attrs:{id:"前置依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前置依赖"}},[a._v("#")]),a._v(" 前置依赖")]),a._v(" "),s("p",[a._v("前置依赖不区分具体平台，无论您希望在哪个平台构建"),s("strong",[a._v("LuaSTGPlus")]),a._v("，都需安装下述依赖项。")]),a._v(" "),s("ul",[s("li",[a._v("支持 C++17 特性的编译器")]),a._v(" "),s("li",[a._v("cmake >= 3.19")]),a._v(" "),s("li",[a._v("git >= 2.25")]),a._v(" "),s("li",[a._v("python >= 3.6")])]),a._v(" "),s("p",[a._v("需要注意，构建过程中需要连接网络以安装依赖，请确保具有可以连通 Github 的网络环境。")]),a._v(" "),s("h2",{attrs:{id:"构建选项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建选项"}},[a._v("#")]),a._v(" 构建选项")]),a._v(" "),s("p",[a._v("下述构建选项可以在编译时传递给 CMake，以开关某些功能，或配置交叉编译环境。")]),a._v(" "),s("h3",{attrs:{id:"lstg-shipping"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lstg-shipping"}},[a._v("#")]),a._v(" LSTG_SHIPPING")]),a._v(" "),s("ul",[s("li",[a._v("可选值：ON(1)/OFF(0)")]),a._v(" "),s("li",[a._v("默认值：ON")])]),a._v(" "),s("p",[a._v("当配置有"),s("code",[a._v("LSTG_SHIPPING")]),a._v("时，代码中供开发所用的功能会全数关闭，包括但不局限于：")]),a._v(" "),s("ul",[s("li",[a._v("脚本及资产热加载")]),a._v(" "),s("li",[a._v("性能剖析视图")]),a._v(" "),s("li",[a._v("调试控制台")]),a._v(" "),s("li",[a._v("部分代码逻辑检查和断言")])]),a._v(" "),s("p",[a._v("建议仅当发布时开启该选项。")]),a._v(" "),s("p",[a._v("当"),s("code",[a._v("LSTG_SHIPPING=0")]),a._v("时，我们称之为"),s("strong",[a._v("开发模式")]),a._v("。")]),a._v(" "),s("h3",{attrs:{id:"lstg-enable-assertions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lstg-enable-assertions"}},[a._v("#")]),a._v(" LSTG_ENABLE_ASSERTIONS")]),a._v(" "),s("ul",[s("li",[a._v("可选值：ON(1)/OFF(0)")]),a._v(" "),s("li",[a._v("默认值：ON(Debug)/OFF(其他)")])]),a._v(" "),s("p",[a._v("该选项用于强制开启"),s("code",[a._v("-D_DEBUG")]),a._v("等调试宏，您通常无需关注该选项。")]),a._v(" "),s("h3",{attrs:{id:"lstg-app-name"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lstg-app-name"}},[a._v("#")]),a._v(" LSTG_APP_NAME")]),a._v(" "),s("ul",[s("li",[a._v("可选值：字符串")]),a._v(" "),s("li",[a._v("默认值："),s("code",[a._v("default")])])]),a._v(" "),s("p",[a._v("该选项用于指定在用户存储路径（如"),s("code",[a._v("AppData")]),a._v("）中的子文件夹名称，以防止存储的分数信息、Replay数据冲突。")]),a._v(" "),s("h3",{attrs:{id:"lstg-parse-cmdline"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lstg-parse-cmdline"}},[a._v("#")]),a._v(" LSTG_PARSE_CMDLINE")]),a._v(" "),s("ul",[s("li",[a._v("可选值：ON(1)/OFF(0)")]),a._v(" "),s("li",[a._v("默认值：ON")])]),a._v(" "),s("p",[a._v("是否允许引擎解析命令行字符串，当开启该选项时，用户将可以通过命令行参数调整引擎的行为，例如：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./LuaSTGPlus2 -graphics"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("vulkan\n")])])]),s("p",[a._v("命令行参数详见"),s("RouterLink",{attrs:{to:"/guide/Cmdline.html"}},[a._v("命令行")]),a._v("章节。")],1),a._v(" "),s("p",[a._v("需要注意，当开启该功能时，所传递给Lua侧的参数必须附加在"),s("code",[a._v("--")]),a._v("之后，例如：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("./LuaSTGPlus2 -graphics"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("vulkan -- launch\n")])])]),s("p",[a._v("如果您希望还原之前的行为，可以关闭该选项，但同时将无法通过命令行参数调整引擎行为。")]),a._v(" "),s("h3",{attrs:{id:"lstg-disable-hot-reload"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lstg-disable-hot-reload"}},[a._v("#")]),a._v(" LSTG_DISABLE_HOT_RELOAD")]),a._v(" "),s("ul",[s("li",[a._v("可选值：ON(1)/OFF(0)")]),a._v(" "),s("li",[a._v("默认值：OFF")])]),a._v(" "),s("p",[a._v("是否关闭热加载功能（仅限"),s("strong",[a._v("开发模式")]),a._v("）。")]),a._v(" "),s("h2",{attrs:{id:"编译方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译方式"}},[a._v("#")]),a._v(" 编译方式")]),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("WARNING")]),a._v(" "),s("p",[a._v("我们不提供安装脚本，请不要使用 "),s("code",[a._v("make install")]),a._v(" 尝试进行安装。")])]),a._v(" "),s("h3",{attrs:{id:"windows"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#windows"}},[a._v("#")]),a._v(" Windows")]),a._v(" "),s("p",[a._v("在安装完前置依赖后，您可以通过"),s("code",[a._v("CMake")]),a._v("命令行或"),s("code",[a._v("CMake")]),a._v("图形化工具进行构建工作。")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("我们推荐直接在"),s("code",[a._v("Visual Studio")]),a._v("中通过"),s("code",[a._v("打开文件夹")]),a._v("功能进行编译和开发工作。")])]),a._v(" "),s("h3",{attrs:{id:"macos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#macos"}},[a._v("#")]),a._v(" MacOS")]),a._v(" "),s("p",[a._v("在安装完前置依赖后，您可以通过"),s("code",[a._v("CMake")]),a._v("命令行进行构建工作。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://github.com/9chu/LuaSTGPlus\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" LuaSTGPlus\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" build\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" build\ncmake -DCMAKE_BUILD_TYPE"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Release "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" -j"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("nproc"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("我们推荐直接在"),s("code",[a._v("CLion")]),a._v("中进行编译和开发工作。")])]),a._v(" "),s("h3",{attrs:{id:"linux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux"}},[a._v("#")]),a._v(" Linux")]),a._v(" "),s("p",[a._v("由于Linux环境相对灵活，请参照SDL2的各类前置依赖按需构建。")]),a._v(" "),s("p",[a._v("此处给出在"),s("code",[a._v("Ubuntu 22.04 Arm64")]),a._v("下的构建流程供参考。")]),a._v(" "),s("h4",{attrs:{id:"安装构建工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装构建工具"}},[a._v("#")]),a._v(" 安装构建工具")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" cmake "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" gcc g++ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" python3\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("WARNING")]),a._v(" "),s("p",[a._v("您所用Linux发行版对应的"),s("code",[a._v("git")]),a._v("、"),s("code",[a._v("cmake")]),a._v("等工具可能不满足需要，若版本过低可能需要您手工编译符合前置要求的版本。")])]),a._v(" "),s("h4",{attrs:{id:"安装依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖"}},[a._v("#")]),a._v(" 安装依赖")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" libx11-xcb-dev libpulse-dev libssl-dev libxext-dev libglx-dev libgl-dev\n")])])]),s("h4",{attrs:{id:"编译-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译-2"}},[a._v("#")]),a._v(" 编译")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone http://github.com/9chu/LuaSTGPlus\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" LuaSTGPlus\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" build\ncmake -DCMAKE_BUILD_TYPE"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Release "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" -j"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("nproc"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("若构建SDL2时出现找不到依赖的头文件的提示，但是确实已经安装了对应的包，则您可能需要删除"),s("code",[a._v("CMakeCache.txt")]),a._v("后重试。")])]),a._v(" "),s("h3",{attrs:{id:"emscripten"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#emscripten"}},[a._v("#")]),a._v(" Emscripten")]),a._v(" "),s("p",[s("strong",[a._v("LuaSTGPlus")]),a._v("使用"),s("strong",[a._v("emscripten")]),a._v("编译到"),s("strong",[a._v("wasm")]),a._v("，使之可以在浏览器中执行。")]),a._v(" "),s("p",[a._v("当您使用"),s("strong",[a._v("emscripten")]),a._v("构建"),s("strong",[a._v("LuaSTGPlus")]),a._v("时，请确保"),s("strong",[a._v("emsdk")]),a._v("已经升级到了最新版本，较老的版本可能会造成无法编译的情况。")]),a._v(" "),s("p",[s("strong",[a._v("emscripten")]),a._v("的环境准备请参考"),s("a",{attrs:{href:"https://emscripten.org/docs/getting_started/downloads.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("官方文档"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("我们推荐在Linux或者macOS环境下进行构建。")])]),a._v(" "),s("h4",{attrs:{id:"准备原生版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备原生版本"}},[a._v("#")]),a._v(" 准备原生版本")]),a._v(" "),s("p",[a._v("由于交叉编译过程依赖一些本机可执行的二进制工具，您需要预先编译好原生版本供使用。")]),a._v(" "),s("p",[a._v("具体构建命令可参考上文，这里不再赘述。")]),a._v(" "),s("h4",{attrs:{id:"构建emscripten版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建emscripten版本"}},[a._v("#")]),a._v(" 构建Emscripten版本")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mdkir cmake-build-release-emscripten\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" cmake-build-release-emscripten\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 请根据实际情况调整工具链位置和原生版本的构建产物目录（需要绝对路径）")]),a._v("\ncmake -DCMAKE_BUILD_TYPE"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Release -DCMAKE_TOOLCHAIN_FILE"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=~")]),a._v("/emsdk/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake -DIcuBuildTools_DIR"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=~")]),a._v("/LuaSTGPlus/build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),a._v(" -j"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("nproc"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=v.exports}}]);